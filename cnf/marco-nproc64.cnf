[mysqld]
# binary log
binlog_row_image=minimal
#loose-binlog_space_limit=4G

# connections
connect_timeout=120
back_log=4K
max_connections=4K
max_prepared_stmt_count=4M

# general
table_open_cache=256K
table_open_cache_instances=64

# InnoDB
innodb_open_files=4K
innodb_redo_log_capacity=16G
innodb_fast_shutdown=0

# Defaults from MySQL 8.0
innodb_doublewrite_files=16
innodb_doublewrite_pages=4
innodb_page_cleaners=4
innodb_parallel_read_threads=4
innodb_read_io_threads=4
innodb_log_buffer_size=16M
innodb_use_fdatasync=OFF
innodb_buffer_pool_instances=8

# Defaults from MySQL 8.4
innodb_change_buffering=none
innodb_flush_method=O_DIRECT
innodb_adaptive_hash_index=OFF
innodb_numa_interleave=1
innodb_io_capacity=10000

# Non-ACID compliant options but improve stability of results
#sync_binlog=1024
#innodb_flush_log_at_trx_commit=0


####################
## Cache
####################
table_definition_cache         = 4096
thread_cache_size              = 1024
thread_stack                   = 256K

#####################
#Per connection
#####################
binlog_cache_size      = 1M
binlog_stmt_cache_size = 1M
join_buffer_size       = 32M
read_buffer_size       = 1M
read_rnd_buffer_size   = 16M
sort_buffer_size       = 1M

#####################
#InnoDB settings
#####################
innodb_monitor_enable           = all

# Defaults from MySQL 8.4
innodb_buffer_pool_in_core_file = OFF
innodb_doublewrite_files        = 2   # 8.0=innodb_buffer_pool_instances * 2
innodb_doublewrite_pages        = 128 # 8.0=innodb_write_io_threads (4 by default)
innodb_use_fdatasync            = 1   # 8.0=0
innodb_log_buffer_size          = 64M # 8.0=16MB
innodb_purge_threads            = 4   # 8.0=4; 8.4=1 if logical processors <= 16 else 4

# Depends on number of logical processors; settings for nproc=64
innodb_buffer_pool_instances    = 16  # 8.0=8; 8.4=(range of 1-64) = min((innodb_buffer_pool_size / innodb_buffer_pool_chunk_size [128M]) / 2), 1/4 of available logical procs)
innodb_page_cleaners            = 16  # 8.0=4; 8.4=number of BP
innodb_parallel_read_threads    = 8   # 8.0=4; 8.4=logical processors / 8 (min 4)
innodb_read_io_threads          = 32  # 8.0=4; 8.4=logical processors / 2 (min 4)

#innodb_write_io_threads         = 32
innodb_write_io_threads         = 8   # 8.0=4; 8.4=4
innodb_sync_array_size          = 12  # 8.0=1; 8.4=1
innodb_redo_log_capacity        = 4G  # Since MySQL 8.4, innodb_dedicated_server configures the following variables: (logical processors / 2) GB, with a maximum of 16GB

#####################
#Replication + binlog settings
#####################
skip-log-bin
